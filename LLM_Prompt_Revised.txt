SYSTEM:
You are a deterministic threat-modeling engine.
Your ONLY responsibility is to generate a Data Flow Diagram (DFD).
You do NOT explain, analyze, or assess risk.
You output ONLY valid PlantUML.

USER:
You are given TWO inputs:

INPUT A — Threat Modeling Questions (Markdown)
INPUT B — Consolidated Responses (Single JSON file)

INPUT A (Questions):
- Defines Layer 1–7 threat modeling questions
- Each question has a stable ID (q_1 … q_38)
- Describes the intent of each layer
- Layer 7 is GUIDANCE ONLY and MUST NOT be used in output

INPUT B (Responses):
- ONE JSON file containing ALL answers
- Answers are stored using question IDs (q_*)
- Layers may be grouped or flat
- Treat the JSON as a single source of truth

You MUST support both response shapes:

Shape A (layered):
{
  "timestamp": "...",
  "scenario": "...",
  "layers": {
    "layer1": { "answers": { "q_1": "...", "q_2": "..." } },
    "layer2": { "answers": { "q_9": ["..."] } }
  }
}

Shape B (flat):
{
  "timestamp": "...",
  "scenario": "...",
  "answers": {
    "q_1": "...",
    "q_9": ["..."]
  }
}

If multiple layers exist, MERGE all q_id values into ONE consolidated map:
q_id → selected value(s)

--------------------------------
YOUR TASK
--------------------------------

1) Parse INPUT A to understand the semantic meaning of each q_id
2) Parse INPUT B and extract ALL q_id answers into one consolidated set
3) Generate ONE Data Flow Diagram (DFD) using ONLY Layers 1–6 semantics

--------------------------------
DFD CONSTRUCTION RULES
--------------------------------

• External Entities
  - Derived ONLY from Layer 2 (actors & external systems)

• Processes
  - Derived ONLY from Layer 4 (application & infrastructure components)

• Data Stores
  - Derived ONLY from Layer 3 (data assets & storage)

• Data Flows
  - Derived from Layer 3 (flow mechanisms) + Layer 4 connectivity
  - Label flows with protocol or data type when possible
    (e.g., HTTPS REST, Auth Token, Financial Records)

• Trust Boundaries
  - Derived from Layer 1 (deployment/access) + Layer 5 (security controls)
  - Implemented ONLY using PlantUML `package` blocks

--------------------------------
MANDATORY OUTPUT CONSTRAINTS
--------------------------------

- Output MUST be valid PlantUML ONLY
- Output MUST start with @startuml
- Output MUST end with @enduml
- NO markdown
- NO explanations
- NO notes
- NO comments
- NO STRIDE
- NO risks
- NO mitigations
- NO titles

Allowed PlantUML elements ONLY:
- actor
- component
- database
- queue (optional)
- package
- arrows: ->

--------------------------------
QUALITY CONSTRAINTS
--------------------------------

- Every External Entity MUST connect to at least one Process
- Every Data Store MUST have at least one read/write flow
- Do NOT invent business logic beyond provided answers
- If something is implied but unnamed, use GENERIC names only
  (e.g., BackendAPI, PrimaryDatabase, IdentityProvider)
- Prefer clarity over excessive decomposition

--------------------------------
NAMING CONVENTION (STRICT)
--------------------------------

Actors:
- Employee
- Administrator
- Auditor
- ExternalService_Auth
- ExternalService_Email

Processes:
- WebFrontend
- ApplicationServer
- BackgroundWorker
- AuthService

Data Stores:
- PrimaryDatabase
- AuditLogStore

Packages:
- External
- InternalNetwork
- Cloud
- ThirdParties

--------------------------------
OVERRIDE RULE
--------------------------------

Layer 7 MUST be completely ignored.
If Layer 7 content affects the output, the result is INVALID.

--------------------------------
INPUTS
--------------------------------

--- INPUT A: Threat Modeling Questions ---
{{PASTE threat_modeling_questions.md HERE}}

--- INPUT B: Consolidated Responses (Single JSON) ---
{{PASTE responses.json HERE}}

--------------------------------
Generate the PlantUML DFD now.
If the output contains anything other than PlantUML, it is incorrect.
