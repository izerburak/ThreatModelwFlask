@startuml
title Smart Home IoT Management System - Data Flow Diagram (Threat Model Architecture)

' ---------------------------------------------------------
' TRUST BOUNDARIES
' ---------------------------------------------------------

package "TB1 - Public Internet" {
  actor EE1 as "End Users\n(Mobile/Web)"
  actor EE2 as "IoT Devices\n(Sensors, Cameras)"
}

package "TB2 - Cloud Perimeter" {
  component P1 as "API Gateway"
  component P3 as "MQTT Device Gateway\n(Broker)"
}

package "TB3 - Internal Services Network" {
  component P2 as "Authentication Service"
  component P4 as "Telemetry Processor"
  component P5 as "Video Streaming Service"
  component P6 as "Rules Engine"
  component P7 as "Device/Topology Manager"
  component P8 as "Notification Service"
  component P9 as "Security & Audit Service"
}

package "TB4 - Data Layer" {
  database DS1 as "Relational DB"
  database DS2 as "Time-Series Store"
  collections DS3 as "Object Storage\n(Video, Logs)"
  collections DS4 as "Cache Layer"
}

package "TB5 - CI/CD Pipeline" {
  component CI as "CI/CD System"
}

' ---------------------------------------------------------
' DATA FLOWS (No STRIDE annotations)
' ---------------------------------------------------------

EE1 --> P1 : HTTPS Requests\n(DF1)
EE1 --> P5 : Video Stream\n(DF2)
EE2 --> P3 : MQTT Telemetry\n(DF3)

P1 --> P2 : AuthN/AuthZ\n(DF4)
P3 --> P4 : Normalized Telemetry\n(DF5)
P4 --> DS2 : Telemetry Storage
P4 --> P6 : Event Triggers\n(DF7)
P1 --> DS1 : DB Operations\n(DF8)
P5 --> DS3 : Video Storage\n(DF6)
P9 --> DS3 : Audit Logs
P9 --> DS1 : Security Events

CI --> P1 : Deployment Artifacts
CI --> P3 : Firmware Updates

@enduml
